language: node_js

node_js:
  - 0.10

# For xunit-file module to put results in shippable folder
env:
 global:
  - XUNIT_FILE=shippable/testresults/result.xml
  #beta
  - secure: cgI4w6j5wbZ5GMVabKg/YyIb+gqJT6hDAgPIsLMZsiT+jTBhvWDj380oERaFtpv08/8k+j1IwJmjL1AcZ9deHG6PGX4mqV4QwAkNeX2a9jiJKSdUxJIkZ1M+Ok6Usj2qSqoGeMWTji7SM1b1vln623dvWvOV/3c0b6Iniz39lMh3Frsfj+IwlLrRvFOv1MWNmibnTuEN7GNi7On8fKegT2YJvrX3wgYfu66R3na5836bD2dKRIofm4JvoXE4Leu13YwlseUXMsizm3SwSO3Hd6ufovdrVyfTQCEHhG1dyV7AOAOzh/bLyCxI6NxID9lbxuG87kuuU9ArORC81/DpWg==
  
  #Create a DB as part of before script to use it
# Make folders for the reports, and create the SQL db
before_script:
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - mkdir -p shippable/src
  - psql -c 'CREATE DATABASE app_test;' -U postgres
  - echo $foo


script:
  - npm test
  - echo $foo
#addons:
 # postgresql: 9.3

# Generate coverage report with istanbul
after_script:
#  - psql -c 'create database if not exists test;' -U postgres
  - ./node_modules/.bin/istanbul cover ./node_modules/.bin/_mocha -- --ui=bdd --reporter=xunit-file
  - ./node_modules/.bin/istanbul report cobertura --dir shippable/codecoverage/
  
before_archive:
  - mv  index.js shippable/src
  
after_archive:
      - echo $SHIPPABLE_ARTIFACTS_URL
    

addons:
    postgresql : "9.3"
  

